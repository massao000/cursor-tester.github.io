<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãƒ†ã‚¹ã‚¿ãƒ¼ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¿…é ˆè¡¨ç¤ºå¯¾å¿œï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold mb-8 text-gray-800 flex items-center gap-2">
    ğŸ–±ï¸ ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ãƒ†ã‚¹ã‚¿ãƒ¼ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¿…é ˆè¡¨ç¤ºå¯¾å¿œï¼‰
  </h1>

  <div id="cursorContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 w-full max-w-7xl"></div>

  <button id="resetAll"
    class="mt-8 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-xl shadow transition">
    å…¨ä½“ãƒªã‚»ãƒƒãƒˆ
  </button>

<script>
/*
  cursorTypes: 
    - name: è¡¨ç¤ºå
    - css: ç›´æ¥é©ç”¨ã™ã‚‹cursorãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ nullï¼‰
    - requiresUpload: ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã«å­˜åœ¨ã—ãªã„ãŸã‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã‹ã©ã†ã‹ï¼ˆtrueãªã‚‰æ³¨æ„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼‰
*/
const cursorTypes = [
  { name: "é€šå¸¸ã®é¸æŠ", css: "default", requiresUpload: false },
  { name: "ãƒ˜ãƒ«ãƒ—ã®é¸æŠ", css: "help", requiresUpload: false },
  { name: "ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä½œæ¥­ä¸­", css: "progress", requiresUpload: false },
  { name: "å¾…ã¡çŠ¶æ…‹", css: "wait", requiresUpload: false },
  { name: "é ˜åŸŸé¸æŠ", css: "crosshair", requiresUpload: false },
  { name: "ãƒ†ã‚­ã‚¹ãƒˆé¸æŠ", css: "text", requiresUpload: false },
  // ä»¥ä¸‹ã¯ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº– cursor ã«å­˜åœ¨ã—ãªã„ã‚«ã‚¹ã‚¿ãƒ åï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ï¼‰
  { name: "æ‰‹æ›¸ãï¼ˆæ‰‹æ›¸ãå…¥åŠ›ï¼‰", css: null, requiresUpload: true },
  { name: "åˆ©ç”¨ä¸å¯", css: "not-allowed", requiresUpload: false },
  { name: "ä¸Šä¸‹ã«æ‹¡å¤§ç¸®å°", css: "ns-resize", requiresUpload: false },
  { name: "å·¦å³ã«æ‹¡å¤§ç¸®å°", css: "ew-resize", requiresUpload: false },
  { name: "æ–œã‚ã«æ‹¡å¤§ç¸®å°1", css: "nwse-resize", requiresUpload: false },
  { name: "æ–œã‚ã«æ‹¡å¤§ç¸®å°2", css: "nesw-resize", requiresUpload: false },
  { name: "ç§»å‹•", css: "move", requiresUpload: false },
  { name: "ä»£æ›¿é¸æŠï¼ˆä»£æ›¿é¸æŠï¼‰", css: null, requiresUpload: true },
  { name: "ãƒªãƒ³ã‚¯ã®é¸æŠ", css: "pointer", requiresUpload: false },
  { name: "å ´æ‰€ã®é¸æŠï¼ˆå ´æ‰€ï¼‰", css: null, requiresUpload: true },
  { name: "äººã®é¸æŠï¼ˆäººï¼‰", css: null, requiresUpload: true }
];

const container = document.getElementById("cursorContainer");
const customCursors = {}; // { key: objectURL }

cursorTypes.forEach((type, idx) => {
  const key = `type-${idx}`;

  const box = document.createElement("div");
  box.className = "bg-white rounded-2xl shadow p-4 flex flex-col ";

  box.innerHTML = `
    <h3 class="text-center font-semibold text-gray-700 mb-2">${type.name}</h3>
    <div id="area-${key}" 
         class="relative h-40 border-2 border-dashed border-gray-300 rounded-xl bg-gradient-to-br from-gray-50 to-gray-100 mb-3 overflow-hidden flex items-center justify-center"
         style="cursor:${type.css ? type.css : 'default'}">
      <canvas class="absolute inset-0 w-full h-full"></canvas>
      <div class="z-10 pointer-events-none"></div>
    </div>

    <div class="flex flex-col gap-2">
      <div class="flex items-center gap-2">
        <input type="file" id="upload-${key}" accept=".cur,.png,.jpg,.gif,.ico"
               class="block w-full text-sm text-gray-600 file:mr-3 file:py-1 file:px-2
                      file:rounded-lg file:border-0 file:text-sm file:font-semibold
                      file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
        <button id="reset-${key}" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded-lg text-sm whitespace-nowrap">
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
      <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¿…é ˆã®æ³¨æ„ã‚¨ãƒªã‚¢ï¼ˆè¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡æ›¿ï¼‰ -->
      <p id="notice-${key}" class="text-xs text-yellow-700 bg-yellow-50 px-3 py-1 rounded-md hidden">
        ã“ã®ã‚«ãƒ¼ã‚½ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚è¡¨ç¤ºã™ã‚‹ã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
      </p>
      </div>
  `;
  container.appendChild(box);

  const area = box.querySelector(`#area-${key}`);
  const canvas = area.querySelector("canvas");
  const ctx = canvas.getContext("2d", { alpha: true });
  const notice = box.querySelector(`#notice-${key}`);
  const upload = box.querySelector(`#upload-${key}`);
  const resetBtn = box.querySelector(`#reset-${key}`);

  // notice ã®åˆæœŸè¡¨ç¤ºï¼ˆrequiresUpload ãŒ true ã®å ´åˆã®ã¿è¡¨ç¤ºï¼‰
  if (type.requiresUpload) {
    notice.classList.remove("hidden");
    // æ—¢å®šã§ã¯ã‚«ãƒ¼ã‚½ãƒ«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºã«ã—ã¦ãŠãï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ç½®ãæ›ãˆã‚‹ï¼‰
    area.style.cursor = "default";
  } else {
    notice.classList.add("hidden");
    // æ¨™æº–å€¤ãŒã‚ã‚‹ãªã‚‰ãã‚Œã‚’é©ç”¨
    if (type.css) area.style.cursor = type.css;
  }

  // é«˜DPIå¯¾å¿œã‚­ãƒ£ãƒ³ãƒã‚¹ãƒªã‚µã‚¤ã‚º
  function resizeCanvasToDisplaySize() {
    const dpr = window.devicePixelRatio || 1;
    const rect = area.getBoundingClientRect();
    const cssW = Math.max(1, Math.floor(rect.width));
    const cssH = Math.max(1, Math.floor(rect.height));
    // skip if same
    if (canvas.width === Math.floor(cssW * dpr) && canvas.height === Math.floor(cssH * dpr)) {
      canvas.style.width = cssW + "px";
      canvas.style.height = cssH + "px";
      return;
    }
    canvas.style.width = cssW + "px";
    canvas.style.height = cssH + "px";
    canvas.width = Math.floor(cssW * dpr);
    canvas.height = Math.floor(cssH * dpr);
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resizeCanvasToDisplaySize();
  let resizeTimer;
  window.addEventListener("resize", () => { clearTimeout(resizeTimer); resizeTimer = setTimeout(resizeCanvasToDisplaySize, 80); });

  // æ‰‹æ›¸ãæç”»ãƒ‡ãƒ¼ã‚¿
  let drawing = false;
  let points = [];
  const lifespan = 2000; // ms

  function getPointerPos(e) {
    const rect = canvas.getBoundingClientRect();
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }

  // pointer ã‚¤ãƒ™ãƒ³ãƒˆã§çµ±ä¸€ï¼ˆã‚¿ãƒƒãƒãƒ»ãƒšãƒ³å¯¾å¿œï¼‰
  area.addEventListener("pointerdown", (e) => {
    if (e.pointerType === "mouse" && e.button !== 0) return;
    area.setPointerCapture?.(e.pointerId);
    drawing = true;
    points = [];
    const p = getPointerPos(e);
    points.push({ x: p.x, y: p.y, time: Date.now() });
    e.preventDefault();
  });
  area.addEventListener("pointermove", (e) => {
    if (!drawing) return;
    const p = getPointerPos(e);
    points.push({ x: p.x, y: p.y, time: Date.now() });
    e.preventDefault();
  });
  area.addEventListener("pointerup", (e) => {
    if (drawing) {
      drawing = false;
      area.releasePointerCapture?.(e.pointerId);
    }
  });
  area.addEventListener("pointercancel", () => { drawing = false; });

  // æç”»ãƒ«ãƒ¼ãƒ—ï¼ˆå¤ã„ç‚¹ã¯ãƒ•ã‚§ãƒ¼ãƒ‰ã—ã¦æ¶ˆãˆã‚‹ï¼‰
  function drawLoop() {
    resizeCanvasToDisplaySize();
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const now = Date.now();
    points = points.filter(p => now - p.time < lifespan);

    if (points.length > 1) {
      ctx.lineWidth = 2;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
      for (let i = 1; i < points.length; i++) {
        const p1 = points[i - 1], p2 = points[i];
        const age = now - p2.time;
        let alpha = 1 - age / lifespan;
        if (alpha < 0) alpha = 0;
        ctx.strokeStyle = `rgba(239,68,68,${alpha})`; // red-500
        ctx.beginPath();
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
      }
    }

    requestAnimationFrame(drawLoop);
  }
  requestAnimationFrame(drawLoop);

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¿…é ˆé …ç›®ã«ã‚‚å¯¾å¿œï¼‰
  upload.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    // è¿½åŠ ï¼šæ—¢å­˜ã® objectURL ãŒã‚ã‚Œã°è§£æ”¾
    if (customCursors[key]) {
      try { URL.revokeObjectURL(customCursors[key]); } catch (err) {}
    }
    customCursors[key] = url;
    // ã‚«ãƒ¼ã‚½ãƒ«ã«é©ç”¨ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚Œã° .cur ã‚„ png ã‚’é©ç”¨ï¼‰
    area.style.cursor = `url(${url}), auto`;
    // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¿…é ˆã®æ³¨æ„ã¯éè¡¨ç¤ºã«ã™ã‚‹
    if (type.requiresUpload) notice.classList.add("hidden");
  });

  // å€‹åˆ¥ãƒªã‚»ãƒƒãƒˆ
  resetBtn.addEventListener("click", () => {
    // revert cursor to standard if available, otherwise default
    if (type.css) area.style.cursor = type.css;
    else area.style.cursor = "default";

    // show notice again for required ones
    if (type.requiresUpload) notice.classList.remove("hidden");

    // clear file input and revoke URL
    if (customCursors[key]) {
      try { URL.revokeObjectURL(customCursors[key]); } catch (err) {}
      delete customCursors[key];
    }
    upload.value = "";
  });
});

// å…¨ä½“ãƒªã‚»ãƒƒãƒˆ
document.getElementById("resetAll").addEventListener("click", () => {
  cursorTypes.forEach((type, idx) => {
    const key = `type-${idx}`;
    const area = document.getElementById(`area-${key}`);
    const upload = document.getElementById(`upload-${key}`);
    const notice = document.getElementById(`notice-${key}`);

    if (!area) return;
    if (type.css) area.style.cursor = type.css;
    else area.style.cursor = "default";

    if (type.requiresUpload && notice) notice.classList.remove("hidden");

    if (upload) upload.value = "";
  });

  // revoke all created object URLs
  Object.keys(customCursors).forEach(k => {
    try { URL.revokeObjectURL(customCursors[k]); } catch (err) {}
    delete customCursors[k];
  });
});
</script>
</body>
</html>
